name: Build

on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  unix:
    runs-on: ${{matrix.os}}
    strategy:
      matrix:
        include:
          - os: macos-14
          - os: macos-15-intel
#          - os: ubuntu-22.04     # fails due to insufficient space
#          - os: ubuntu-22.04-arm # fails due to insufficient space
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/unix
        id: build
        with:
          version: "6.10.0"
      - uses: actions/upload-artifact@v4
        with:
          name: ${{steps.build.outputs.fn}}
          path: ${{steps.build.outputs.path}}

  windows:
    runs-on: ${{matrix.os}}
    strategy:
      matrix:
        include:
          - os: windows-2022
            comp: llvm1706
            archive: llvm-mingw-20231128-ucrt-x86_64.zip
            link: https://github.com/mstorsjo/llvm-mingw/releases/download/20231128/
          - os: windows-2022
            comp: mingw1310
            archive: MinGW-w64-x86_64-13.1.0-release-posix-seh-msvcrt-rt_v11-rev1.7z
            link: https://download.qt.io/development_releases/prebuilt/mingw_64/
          - os: windows-11-arm
            comp: llvm1706
            archive: llvm-mingw-20231128-ucrt-aarch64.zip
            link: https://github.com/mstorsjo/llvm-mingw/releases/download/20231128/
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/windows
        id: build
        with:
          version: "6.10.0"
          comp:    ${{matrix.comp}}
          archive: ${{matrix.archive}}
          link:    ${{matrix.link}}
      - uses: actions/upload-artifact@v4
        with:
          name: ${{steps.build.outputs.fn}}
          path: ${{steps.build.outputs.path}}

  windows-msvc:
    runs-on: ${{matrix.os}}
    strategy:
      matrix:
        include:
          - os: windows-2022
          - os: windows-11-arm
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/windows-msvc
        id: build
        with:
          version: "6.10.0"
      - uses: actions/upload-artifact@v4
        with:
          name: ${{steps.build.outputs.fn}}
          path: ${{steps.build.outputs.path}}
